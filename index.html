<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Trivia Game</title>
    </head>
    <body>
        <!--Subjects-->
        <div class="category-row" id="subject-buttons">
            <button class="category-btn">History</button>
            <button class="category-btn">Geography</button>
            <button class="category-btn">Computer</button>
        </div>

        <!--Levels-->
        <div class="level-row" id="level-buttons">
            <button class="level-btn">100</button>
            <button class="level-btn">200</button>
            <button class="level-btn">300</button>
            <button class="level-btn">400</button>
            <button class="level-btn">500</button>
        </div>

        <div id="question-container"></div>

        <!-- <button class="submit">View Options</button>-->


        <script>
            // When user сhooses a theme
            let selectedSubject = null;

            document.querySelectorAll('.category-btn').forEach(button => {
            button.addEventListener('click', () => {
                selectedSubject = button.textContent;

                // CLEARING & COLORING :)
                // Clear all category colors
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.style.backgroundColor = '';
                });
                // Color the pressed category
                button.style.backgroundColor = '#f0b400'; // или другой цвет
                
                // Clear selected levels' colors
                document.querySelectorAll('.level-btn').forEach(btn => {
                    btn.style.backgroundColor = '';
                });
                // Clear previously displayed question (if any)
                document.getElementById('question-container').innerHTML = '';    

                // Fetch-request: theme availability check
                fetch(`/check-subject?subject=${selectedSubject}`)
                .then(res => res.json())
                .then(data => {
                    if (data.available) {
                    } else {
                    alert(`All questions on ${selectedSubject} were answered.\nPlease select another theme.`);
                    }
                })
                .catch(err => console.error(err));
            });
            });

            // When user сhooses a level
            document.querySelectorAll('.level-btn').forEach(button => {
            button.addEventListener('click', () => {
                // If the theme is not selected
                if (!selectedSubject) {
                alert('Please choose a theme first.');
                return;
                }
                
                const level = button.textContent;

                // CLEARING & COLORING :)
                // Clear all levels' colors
                document.querySelectorAll('.level-btn').forEach(btn => {
                    btn.style.backgroundColor = '';
                });
                // Color the pressed button
                    button.style.backgroundColor = '#f0b400'; // или другой цвет

                // Fetch-request: question availability check
                fetch(`/check-level?subject=${selectedSubject}&level=${level}`)
                .then(res => res.json())
                .then(data => {
                    if (data.available) {

                        // Display the question
                        document.getElementById('question-container').innerHTML = `
                            <h2>${data.question}</h2>
                            <button>${data.options.a}</button>
                            <button>${data.options.b}</button>
                            <button>${data.options.c}</button>
                            <button>${data.options.d}</button>
                            `;
                    } else {
                    alert(`This question has been answered. Try another one`);
                    }
                })
                .catch(err => console.error(err));
            });
            });
        </script>
    </body>
</html>